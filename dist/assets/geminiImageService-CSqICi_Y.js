import{g as E}from"./index-BKTkXBJZ.js";const D="https://generativelanguage.googleapis.com/v1beta",I=["imagen-3.0-generate-002","imagen-3.0-fast-generate-001","imagen-3.0-generate-001"];async function A(r,e){var p,G,f;console.log("ðŸŽ¨ [DEBUG] Starting Gemini/Imagen image generation..."),console.log("ðŸŽ¨ [DEBUG] Prompt:",r.substring(0,100)+(r.length>100?"...":"")),console.log("ðŸŽ¨ [DEBUG] Options:",e);const a=E("GEMINI_API_KEY");if(!a)throw console.error("âŒ [DEBUG] GEMINI_API_KEY not configured"),new Error("GEMINI_API_KEY is not set. Please configure your API keys.");const i=B(r,e);console.log("ðŸŽ¨ [DEBUG] Enhanced prompt length:",i.length);const s={contents:[{role:"user",parts:[{text:i}]}],generationConfig:{temperature:.7,topK:40,topP:.95,maxOutputTokens:1024}};let n=null,g=[...I];try{console.log("ðŸ” [DEBUG] Discovering available image models...");const t=await U();if(t.length>0){console.log("âœ… [DEBUG] Found available image models:",t);const o=[...t,...I];g=Array.from(new Set(o))}else console.log("âš ï¸ [DEBUG] No image models discovered, using fallback list")}catch(t){console.warn("âš ï¸ [DEBUG] Could not discover models, using fallback list:",t)}console.log("ðŸŽ¨ [DEBUG] Models to try (deduplicated):",g);for(const t of g)try{console.log(`ðŸŽ¨ [DEBUG] Trying model: ${t}`);const o=await fetch(`${D}/models/${t}:generateContent?key=${a}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(console.log(`ðŸŽ¨ [DEBUG] ${t} API response status: ${o.status}`),!o.ok){const m=await o.json().catch(()=>({})),u=`${o.status} - ${((p=m.error)==null?void 0:p.message)||o.statusText}`;if(o.status===404||o.status===403){console.warn(`âš ï¸ [DEBUG] Model ${t} not available (${o.status}), trying next...`),n=new Error(u);continue}throw console.error(`âŒ [DEBUG] ${t} API error:`,u),new Error(`Gemini Image error: ${u}`)}const c=await o.json();if(console.log(`ðŸŽ¨ [DEBUG] ${t} response received, candidates:`,((G=c.candidates)==null?void 0:G.length)||0),!c.candidates||c.candidates.length===0)throw console.error(`âŒ [DEBUG] ${t} returned no candidates`),new Error("Gemini image generation failed to return a result.");const l=c.candidates[0];if(console.log(`ðŸŽ¨ [DEBUG] ${t} candidate parts:`,((f=l.content.parts)==null?void 0:f.length)||0),!l.content.parts||l.content.parts.length===0)throw console.error(`âŒ [DEBUG] ${t} returned no content parts`),new Error("Gemini image generation failed to return image data.");const d=l.content.parts.find(m=>m.inlineData);if(!(d!=null&&d.inlineData))throw console.error(`âŒ [DEBUG] ${t} returned no inline data`),console.error("âŒ [DEBUG] Available parts:",l.content.parts),new Error("Gemini did not return image data in the expected format.");const{mimeType:y,data:w}=d.inlineData;console.log(`âœ… [DEBUG] ${t} image generated successfully, type: ${y}, data size: ${w.length} chars`);const $=`data:${y};base64,${w}`;return console.log("ðŸŽ¨ [DEBUG] Gemini image generation completed"),$}catch(o){console.warn(`âš ï¸ [DEBUG] Failed with ${t}:`,o),n=o instanceof Error?o:new Error(String(o));continue}console.error("âŒ [DEBUG] All Gemini/Imagen models failed");const h=(n==null?void 0:n.message)||"";throw h.includes("404")||h.includes("not found")?new Error(`No Imagen models are accessible with your API key. This could be due to:
â€¢ Regional restrictions (some models only available in certain regions)
â€¢ Early access requirements (some models need whitelisting)
â€¢ API tier limitations

Try using Flux Schnell (Replicate) instead, or check https://aistudio.google.com for model availability in your region.`):n||new Error("Failed to generate image with all available Gemini/Imagen models")}function B(r,e){let a=r;return e!=null&&e.aspectRatio&&(a+=`, ${{"16:9":"wide cinematic aspect ratio (16:9)","9:16":"vertical mobile aspect ratio (9:16)","1:1":"square aspect ratio (1:1)"}[e.aspectRatio]}`),e!=null&&e.style&&(a+=`, ${{photographic:"photographic style, realistic, high detail",artistic:"artistic style, creative, visually appealing",realistic:"realistic style, detailed, lifelike"}[e.style]}`),(e==null?void 0:e.quality)==="high"&&(a+=", high quality, detailed, sharp focus"),a+=", well-lit, good composition, professional quality",a}function v(){return!!E("GEMINI_API_KEY")}async function U(){const r=E("GEMINI_API_KEY");if(!r)throw new Error("GEMINI_API_KEY is not set");try{const e=await fetch(`${D}/models?key=${r}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Failed to list models: ${e.status} ${e.statusText}`);const i=(await e.json()).models||[];return console.log("ðŸ“‹ Available Gemini models:",i.map(s=>s.name)),i.filter(s=>{const n=s.name.replace("models/","");return n.includes("imagen")||n.includes("image")}).map(s=>s.name.replace("models/",""))}catch(e){throw console.error("Failed to list models:",e),e}}export{A as generateGeminiImage,v as isGeminiAvailable,U as listAvailableModels};
